{% extends 'basefront.html.twig' %}

{% block css %}
	<link href="{{asset('css/style.css')}}" rel="stylesheet"/>
	<link href="{{asset('css/detailspage.css')}}" rel="stylesheet"/>
	<link rel="stylesheet" href="{{ asset('bundles/mercuryseriesflashy/css/flashy.css') }}" / >
{% endblock %}
{%block bodysection%}
	<section class="job-section section-padding pb-0">
		<div class="container" style="margin-top:-70px !important;">
			<div class="row">

				<div>
					<h3 class="job-title mb-0">Candidature pour le poste:
						{{c.idoffre.poste}}</h3>

					<div class="job-thumb job-thumb-detail">
						<div class="d-flex flex-wrap align-items-center border-bottom pt-lg-3 pt-2 pb-3 mb-4" style="margin-left:200px !important;">
							<p class="job-location mb-0">
								<i class="custom-icon bi-geo-alt me-1"></i>
								{{c.idoffre.lieu}}
							</p>

							<p class="job-date mb-0">
								<i class="custom-icon bi-clock me-1"></i>
								Expire le:
								{{c.idoffre.dateexpiration|date('d-m-Y')}}
							</p>

							{# <p class="job-price mb-0">
																																			                                        <i class="custom-icon bi-cash me-1"></i>
																																			                                        $20k
																																			                                    </p>#}

							<div class="d-flex">

								<div class="badge badge-level">{{c.idoffre.idtype.description}}</div>
								<div class="badge">{{c.idoffre.specialite}}</div>


							</div>
							<div style="margin-left:80px !important;">
								<h6 class="mt-4 mb-3">Job Description</h6>

								<p>{{c.idoffre.description}}</p>
							</div>
						</div>


						{#<h5 class="mt-4 mb-3">Nombre de candidats</h5>
																														
																														                                <p class="mb-1"> 5 </p>#}

						<h5 class="mt-4 mb-3">
							Candidat:
							{{c.idcandidat.nom ~ ' ' ~ c.idcandidat.prenom}}</h5>

						<p>
							Candidature id:
							{{c.id}}
						</p>


					</div>
				</div>

				<div class="col-details col-12 mt-5 mt-lg-0">
					<div class="job-thumb job-thumb-detail-box bg-white shadow-lg">

						<div class="d-flex align-items-center">


							<p class="mb-0" style="margin-right:400px !important;">Détails candidature</p>
							<div>
								{#should be disabled if candidature etat != enregistrée #}
								{% if c.etat|lower != "enregistrée" %}
									<div class="badge" style="font-size:18px !important; margin-left:200px !important;">Validée</div>
								{% else %}
									<a href="{{path('validerCandidature', {'id': c.id})}}" class="custom-btn btn mt-2">Valider la candidature</a>
								{% endif %}
								
							</div>

						</div>


						<h6 class="mt-3 mb-2">Détails</h6>

						<p>Date de candidature:
							{{c.date|date('d-m-Y')}}</p>
						<p>Etat de la candidature:
							{{c.etat}}</p>

						<h6 class="mt-4 mb-3">Contact</h6>

						{#<p class="mb-2">
																														                                    <i class="custom-icon bi-globe me-1"></i>
																														
																														                                    <a href="#" class="site-footer-link">
																														                                        www.jobbportal.com
																														                                    </a>
																														                                </p>#}

						<p class="mb-2">
							<i class="custom-icon bi-telephone me-1"></i>

							<a class="site-footer-link">
								{{c.idcandidat.tel}}
							</a>
						</p>

						<p>
							<i class="custom-icon bi-envelope me-1"></i>

							<a class="site-footer-link">
								{{c.idcandidat.email}}
							</a>
						</p>
						{#  displaying the pdf files #}
						<div class="row">

							<h6 class="mt-4 mb-3">Documents</h6>
							<div class="col-lg-4" style="margin-left: 150px !important;">

								<object id="cv-object" data="http://localhost/postulitn/cv/{{c.cv}}" type="application/pdf" width="200px" height="250px"></object>

								<button id="zoom-cv" class="badge badge-level">Ouvrir le CV</button>
							</div>
							<script>
								var cvObject = document.getElementById("cv-object");
var zoomButton = document.getElementById("zoom-cv");
var pdfUrlCV = "http://localhost/postulitn/cv/{{ c.cv }}";


zoomButton.addEventListener("click", function () {

window.open(pdfUrlCV, '_blank');


});
							</script>


							<span class="col-lg-4">
								<object id="lettre-object" data="http://localhost/postulitn/lettres/{{c.lettre}}" type="application/pdf" width="200px" height="250px"></object>

								<button class="badge badge-level" id="zoom-lettre">Ouvrir la lettre de motivation</button>
							</span>
							<script>
								var lettreObject = document.getElementById("lettre-object");
var zoomButton = document.getElementById("zoom-lettre");
var pdfUrlLettre = "http://localhost/postulitn/lettres/{{ c.lettre }}";

zoomButton.addEventListener("click", function () {
window.open(pdfUrlLettre, '_blank');
});
							</script>

						</div>


					</div>
				</div>

			</div>

		</div>
		<div class="row">
			<div class="col-details col-12 mt-5 mt-lg-0">
				<div class="job-thumb job-thumb-detail-box bg-white shadow-lg">
					<div class="d-flex align-items-center">


						<p class="mb-0">Détails entretiens</p>
						<a href="{{path('app_comptes_show2', {'idcandidat': c.idcandidat.id})}}" class="custom-btn custom-border-btn btn mt-2 ms-lg-4 ms-3">Profil du candidat</a>


					</div>

					<div class="row">
						{% if ( entretiens is empty)%}
							<div class="col-lg-6">
								<h6 class="mt-4 mb-3">Pas d'entretiens programmés</h6>
								<a href="{{path('addEntretien', {'id': c.id})}}" class="custom-btn btn mt-2">Programmer un entretien</a>
							</div>
						{% elseif entretiens|length ==1 %}
							{% if entretiens[0].type|lower == "présentiel" %}

								<div class="col-lg-4">
									<h6 class="mt-4 mb-3">Entretien par téléphone</h6>
									<a href="{{path('addEntretien', {'id': c.id})}}" class="custom-btn btn mt-2">Programmer un entretien</a>

								</div>
								<span class="col-lg-4">

									<h6 class="mt-4 mb-3">Entretien en présentiel</h6>
									<p>
										<i class="custom-icon bi-calendar me-1"></i>
										{{entretiens[0].date|date('d-m-Y')}}
									</p>

									<p>
										<i class="custom-icon bi-clock me-1"></i>
										{{entretiens[0].heure}}
									</p>
									<p>
										<i class="custom-icon bi-geo-alt me-1"></i>
										{{entretiens[0].lieu}}
									</p>
									<a href="{{path('updateEntretien',{'id': entretiens[0].id})}}" class="custom-btn btn mt-2">Modifier</a>

								</span>

							{%else %}

								<div class="col-lg-4">
									<h6 class="mt-4 mb-3">Entretien par téléphone</h6>
									<p>
										<i class="custom-icon bi-calendar me-1"></i>
										{{entretiens[0].date|date('d-m-Y')}}
									</p>

									<p>
										<i class="custom-icon bi-clock me-1"></i>
										{{entretiens[0].heure}}
									</p>

									<a href="{{path('updateEntretien' , {'id': entretiens[0].id})}}" class="custom-btn btn mt-2">Modifier</a>

								</div>
								<span class="col-lg-4">

									<h6 class="mt-4 mb-3">Entretien en présentiel</h6>
									<a href="{{path('addEntretien', {'id': c.id})}}" class="custom-btn btn mt-2">Programmer un entretien</a>

								</span>

								{%endif%}
							{% else %}
								{% if entretiens[0].type|lower == "téléphone"  %}
									{% set entTel= entretiens[0] %}
									{% set entPres= entretiens[1] %}
								{% else %}
									{% set entTel= entretiens[1] %}
									{% set entPres= entretiens[0] %}
								{% endif %}

								<div class="col-lg-4">
									<h6 class="mt-4 mb-3">Entretien par téléphone</h6>
									<p>
										<i class="custom-icon bi-calendar me-1"></i>
										{{entTel.date|date('d-m-Y')}}
									</p>

									<p>
										<i class="custom-icon bi-clock me-1"></i>
										{{entTel.heure}}
									</p>
									<a href="{{path('updateEntretien', { 'id': entTel.id})}}" class="custom-btn btn mt-2">Modifier</a>


								</div>
								<span class="col-lg-4">

									<h6 class="mt-4 mb-3">Entretien en présentiel</h6>
									<p>
										<i class="custom-icon bi-calendar me-1"></i>
										{{entPres.date|date('d-m-Y')}}
									</p>

									<p>
										<i class="custom-icon bi-clock me-1"></i>
										{{entPres.heure}}
									</p>
									<p>
										<i class="custom-icon bi-geo-alt me-1"></i>
										{{entPres.lieu}}
									</p>
									<a href="{{path('updateEntretien', { 'id': entPres.id})}}" class="custom-btn btn mt-2">Modifier</a>
								</span>

							</div>

						{% endif %}

						<div >

						<h6 class="mt-4 mb-3">Résultat</h6>
						 {% set accept='no' %}
						{% if entretiens|length == 2%}
						
							{% if entretiens[0].date < date('now') and entretiens[1].date < date('now') %}
								{% set accept='yes' %}
							{% endif %}
						
						{% endif %}
						{% if accept=='yes' %}
						<a href="{{path('accepterCandidature', {'id': c.id})}}" class="btn btn-primary">Accepter</a>
						<a href="{{path('refuserCandidature', {'id': c.id})}}" class="btn btn-danger">Refuser</a>
						{% else %}
						<div class="badge" style="font-size:14px !important; background-color:#0E1947 !important; color:white !important;">En attente du passage des entretiens.</div>

						{% endif %}

				
					
					
					</div>

					</div>
			
			
				
					

					
				</div>
			</div>

		</div>
	</div>
</section>
{% endblock %}
